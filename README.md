# sparta-java-project-final
ì´ í”„ë¡œì íŠ¸ëŠ” `Product`, `Order`, `User` ë„ë©”ì¸ì„ ê°€ì§„ **MSA ì•„í‚¤í…ì²˜**ì…ë‹ˆë‹¤.  
ê° ì„œë¹„ìŠ¤ëŠ” ê°œë³„ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³ , Kafkaë¥¼ í†µí•œ ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ ê³¼  
ELK ìŠ¤íƒ ë° Prometheus + Grafana ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ì„ êµ¬ì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤.

---

## âš™ï¸ ì„œë¹„ìŠ¤ êµ¬ì„±

| ì„œë¹„ìŠ¤ ì´ë¦„     | ì„¤ëª…                            | í¬íŠ¸        |
|----------------|----------------------------------|-------------|
| `product-api`  | ìƒí’ˆ API ì„œë¹„ìŠ¤                 | 8082        |
| `order-api`    | ì£¼ë¬¸ API ì„œë¹„ìŠ¤                 | 8083        |
| `user-api`     | ì‚¬ìš©ì API ì„œë¹„ìŠ¤               | 8084        |
| `product-db`   | ìƒí’ˆ DB (MySQL)                | 3306        |
| `order-db`     | ì£¼ë¬¸ DB (MySQL)                | 3307        |
| `user-db`      | ì‚¬ìš©ì DB (MySQL)              | 3308        |
| `redis`        | In-memory ìºì‹œ ì„œë²„            | 6379        |
| `zookeeper`    | Kafka coordination              | 2181        |
| `kafka`        | ë©”ì‹œì§€ ë¸Œë¡œì»¤                   | 9093        |
| `elasticsearch`| ë¡œê·¸ ì €ì¥ì†Œ                    | 9200        |
| `logstash`     | ë¡œê·¸ ìˆ˜ì§‘ê¸°                    | 5001, 9600  |
| `kibana`       | ë¡œê·¸ ì‹œê°í™” UI                 | 5601        |
| `prometheus`   | ë©”íŠ¸ë¦­ ìˆ˜ì§‘ê¸°                  | 9090        |
| `grafana`      | ë©”íŠ¸ë¦­ ì‹œê°í™” ëŒ€ì‹œë³´ë“œ         | 3000        |
| `zipkin`       | ë¶„ì‚° ì¶”ì  ì‹œìŠ¤í…œ               | 9411        |
| `eureka-server`  | ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (Service Discovery) | 8761   |
| `gateway-service`| API Gateway (Spring Cloud Gateway + Eureka Client) | 8080 |

---

## ğŸ”— ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°

ëª¨ë“  ì»¨í…Œì´ë„ˆëŠ” ë™ì¼í•œ Docker ë„¤íŠ¸ì›Œí¬ (`elk`) ìƒì— ì—°ê²°ë˜ì–´ ìˆì–´  
ì»¨í…Œì´ë„ˆ ì´ë¦„ìœ¼ë¡œ ì„œë¡œ í†µì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ì•„í‚¤í…ì²˜
```text
                            +----------------+
                            |    Grafana     | (3000)
                            | (Dashboard UI) |
                            +--------+-------+
                                     |
                                     â†“
                            +--------+-------+
                            |   Prometheus   | (9090)
                            | (Metrics ìˆ˜ì§‘) |
                            +--------+-------+
                                     |
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â†“                              â†“                                â†“
+----------------+        +----------------+                +----------------+
| product-api    |â”€â”€â”€â”€â”€â”€â”€â†’|  product-db     |                |   Redis Cache  |
| (8082)         |        |  (MySQL 3306)   |                |     (6379)     |
+----------------+        +----------------+                +----------------+
       â†‘
       â”‚ Kafka ì´ë²¤íŠ¸ ë°œí–‰
       â†“
+----------------+        +----------------+
|  order-api     |â”€â”€â”€â”€â”€â”€â”€â†’|  order-db       |
|  (8083)        |        |  (MySQL 3307)   |
+----------------+        +----------------+
       â†‘
       â†“
+----------------+        +----------------+
|  user-api      |â”€â”€â”€â”€â”€â”€â”€â†’|   user-db       |
|  (8084)        |        |   (MySQL 3308)  |
+----------------+        +----------------+

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¡œê·¸ ìˆ˜ì§‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â†“                                       â†“
+--------+                          +----------------+
| Logstash|â”€â”€â”€â”€â†’ ElasticSearch â†’â”€â”€â†’|    Kibana      |
| (5001)  |                         |    (5601)      |
+--------+                          +----------------+

   +------------------------+
   |   gateway-service      | (8080)
   |  - Spring Cloud Gateway
   |  - Eureka Client       |
   +-----------+------------+
               |
               â†“
        [ Eureka Server ]
            (8761)

```

---

## ğŸ“ˆ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ëª¨ë‹ˆí„°ë§ (Prometheus + Grafana)

ê° ì„œë¹„ìŠ¤ëŠ” `Micrometer`ì™€ `Prometheus`ë¥¼ í™œìš©í•˜ì—¬ **ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‚´ë¶€ ìƒíƒœì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘**í•©ë‹ˆë‹¤.

### ğŸ’¡ Micrometer ê¸°ë³¸ ë©”íŠ¸ë¦­

Spring Boot Actuatorì™€ Micrometerë¥¼ í†µí•´ ì•„ë˜ì™€ ê°™ì€ ê¸°ë³¸ ë©”íŠ¸ë¦­ì´ ìˆ˜ì§‘ë©ë‹ˆë‹¤:

| ë©”íŠ¸ë¦­ ì´ë¦„           | ì„¤ëª…                             |
|------------------------|----------------------------------|
| `jvm.memory.used`      | JVM í™/ë…¼í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰         |
| `jvm.gc.pause`         | GC ì‹œê°„ ë° íšŸìˆ˜                   |
| `http.server.requests` | HTTP ìš”ì²­ ìˆ˜, ì‘ë‹µ ì‹œê°„           |
| `process.cpu.usage`    | ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ CPU ì‚¬ìš©ëŸ‰         |
| `logback.events`       | ë¡œê·¸ ë ˆë²¨ë³„ ë¡œê·¸ ìˆ˜ (info, error ë“±) |

### ğŸ›  ì»¤ìŠ¤í…€ ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ ì˜ˆì‹œ

ê° ì„œë¹„ìŠ¤ì—ëŠ” ë„ë©”ì¸ íŠ¹í™” ë©”íŠ¸ë¦­ë„ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

#### order-api

| ë©”íŠ¸ë¦­ ì´ë¦„                  | ì„¤ëª…                                |
|------------------------------|-------------------------------------|
| `order_created_total`        | ì£¼ë¬¸ ìƒì„± ì„±ê³µ íšŸìˆ˜                 |
| `order_failed_total`         | ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨ íšŸìˆ˜                 |
| `order_processing_time`      | ì£¼ë¬¸ ìƒì„±/ì¡°íšŒ ì†Œìš” ì‹œê°„ (íƒ€ì´ë¨¸)   |
| `order_get_by_id_success`    | ì£¼ë¬¸ ì¡°íšŒ ì„±ê³µ ì¹´ìš´í„°               |
| `order_get_by_id_failure`    | ì£¼ë¬¸ ì¡°íšŒ ì‹¤íŒ¨ ì¹´ìš´í„°               |
| `order_get_by_id_duration`   | ì£¼ë¬¸ ì¡°íšŒ ì²˜ë¦¬ ì‹œê°„ íƒ€ì´ë¨¸          |

#### product-api

| ë©”íŠ¸ë¦­ ì´ë¦„                        | ì„¤ëª…                                |
|-------------------------------|-------------------------------------|
| `product_created_total`       | ìƒí’ˆ ìƒì„± ì„±ê³µ íšŸìˆ˜               |
| `product_create_failed_total` | ìƒí’ˆ ìƒì„± ì‹¤íŒ¨ íšŸìˆ˜              |
| `product_create_duration`     | ìƒí’ˆ ìƒì„± ì²˜ë¦¬ ì‹œê°„  |
| `product_view_total`          | ë‹¨ì¼ ìƒí’ˆ ì¡°íšŒ ìˆ˜              |
| `product_list_total`          | ì „ì²´ ìƒí’ˆ ëª©ë¡ í˜¸ì¶œ ìˆ˜             |
| `product_stock_decreased_total`    | ì¬ê³  ê°ì†Œ ì„±ê³µ íšŸìˆ˜         |
| `product_stock_failed_total`    | ì¬ê³  ë¶€ì¡±ìœ¼ë¡œ ì‹¤íŒ¨í•œ íšŸìˆ˜         |

#### AOP ê¸°ë°˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘

ì„œë¹„ìŠ¤ ë©”ì„œë“œì— `@TimedMetric("ì´ë¦„")` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì´ë©´ ìë™ìœ¼ë¡œ ì•„ë˜ ë©”íŠ¸ë¦­ì´ ìˆ˜ì§‘ë©ë‹ˆë‹¤:

- `${ì´ë¦„}_success` : ë©”ì„œë“œ ì„±ê³µ íšŸìˆ˜
- `${ì´ë¦„}_failure` : ë©”ì„œë“œ ì‹¤íŒ¨ íšŸìˆ˜
- `${ì´ë¦„}_duration` : ë©”ì„œë“œ ì‹¤í–‰ ì‹œê°„

### ğŸ“Š Grafana ëŒ€ì‹œë³´ë“œ

Grafanaì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëŒ€ì‹œë³´ë“œë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- ì „ì²´ ì£¼ë¬¸ ì„±ê³µ/ì‹¤íŒ¨ ì¶”ì´
- ì„œë¹„ìŠ¤ë³„ HTTP ì‘ë‹µ ì‹œê°„ ë¶„í¬
- Kafka ì „ì†¡ ì„±ê³µë¥ 
- ì»¨í…Œì´ë„ˆ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ (CPU, Memory)
- JVM GC ë™ì‘ í˜„í™©

### ğŸ”Œ Prometheus ì—”ë“œí¬ì¸íŠ¸

ê° ì„œë¹„ìŠ¤ëŠ” `/actuator/prometheus` ê²½ë¡œë¥¼ í†µí•´ Prometheusê°€ ë©”íŠ¸ë¦­ì„ ìˆ˜ì§‘í•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œí•©ë‹ˆë‹¤:

- `http://product-api:8082/actuator/prometheus`
- `http://order-api:8083/actuator/prometheus`
- `http://user-api:8084/actuator/prometheus`

PrometheusëŠ” `prometheus.yml`ì˜ `scrape_configs` ì„¤ì •ì„ í†µí•´ ìœ„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜ì§‘í•©ë‹ˆë‹¤.

### ğŸ“ Grafana ê¸°ë³¸ ì ‘ì† ì •ë³´

```text
URL: http://localhost:3000
ID / PW: admin / admin
```

